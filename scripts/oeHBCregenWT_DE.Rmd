---
title: "Wild Type Regeneration, Differential Expression"
author: "Russell Fletcher"
date: '`r Sys.Date()`'
output:
html_document:
code_folding: hide
toc: yes
toc_float: yes
fig_width: 10
fig_height: 10
---

```{r options, echo=FALSE, results="hide",mesasge=FALSE, error=FALSE,include=FALSE}
knitr::opts_chunk$set(fig.align="center", cache=TRUE, error=FALSE, message=FALSE, warning=FALSE, results="hide")

expt_str <- "oeHBCregenWT"
clust_dir <- file.path("../output/clust", expt_str)
viz_dir <- file.path("../output/viz", expt_str)
DE_dir <- file.path("../output/DE", expt_str)
esh <- gsub("Expt","E",expt_str)

library(clusterExperiment); library(limma)
```

### loading wt regeneration data
```{r loadingData}

load(file=file.path(clust_dir, paste0(esh, "_PCA.Rda")))
load(file=file.path(clust_dir, paste0(esh, "_lineageData2.Rda")))
load(file=file.path(clust_dir, paste0(esh, "_none_fq_ruv1_nobio_nobatch_all_merge_10PCadjP03.Rda")))

Xmat <- transform(cmobjM)
Xmat <- Xmat[,rownames(X)]

```

### DE using the UI/cl1 cells as the start prior to the HBCact(24) starting point from slingshot
```{r differentialExpression}

###--- neuronal lineage DE
##-- one versus all comparisons
NLoneVallDE500 <- getBestFeatures(nlm2, nlclusters2, contrastType="OneAgainstAll",contrastAdj="All", number=500, p.value=0.05)
write.table(NLoneVallDE500, file.path(DE_dir,"NL_DE_oneVall_limma_500.txt"),quote=FALSE,sep="\t")

###--- sustentacular cell lineage DE
##-- one versus all comparisons
SLoneVallDE500 <- getBestFeatures(slm2, slclusters2, contrastType="OneAgainstAll",contrastAdj="All", number=500, p.value=0.05)
write.table(SLoneVallDE500, file.path(DE_dir,"SL_DE_oneVall_limma_500.txt"),quote=FALSE,sep="\t")


###--- HBC renewal lineage DE
##-- one versus all comparisons
HLoneVallDE500 <- getBestFeatures(hlm2, hlclusters2, contrastType="OneAgainstAll",contrastAdj="All", number=500, p.value=0.05)
write.table(HLoneVallDE500, file.path(DE_dir,"HL_DE_oneVall_limma_500.txt"),quote=FALSE,sep="\t")

#####
##-- pairwise comparisons
NLpairwise1000 <- getBestFeatures(nlm2, nlclusters2, contrastType="Pairs",contrastAdj="All", number=1000, p.value=0.05)
write.table(NLoneVallDE500_2, file.path(DE_dir,"NL_DE_pairwise_limma_1000.txt"),quote=FALSE,sep="\t")

###--- sustentacular cell lineage DE
##-- pairwise comparisons
SLpairwiseDE1000 <- getBestFeatures(slm2, slclusters2, contrastType="Pairs",contrastAdj="All", number=1000, p.value=0.05)
write.table(SLoneVallDE500_2, file.path(DE_dir,"SL_DE_pairwise_limma_1000.txt"),quote=FALSE,sep="\t")


###--- HBC renewal lineage DE
##-- pairwise comparisons
HLpairwiseDE1000 <- getBestFeatures(hlm2, hlclusters2, contrastType="Pairs",contrastAdj="All", number=1000, p.value=0.05)
write.table(HLoneVallDE500_2, file.path(DE_dir,"HL_DE_pairwise_limma_1000.txt"),quote=FALSE,sep="\t")

###--- saving DE gene matrices and lists
save(HLoneVallDE500, SLoneVallDE500, NLoneVallDE500, file=file.path(DE_dir,paste0(esh,"_oneVall500_DE.Rda")))
save(HLpairwiseDE1000, SLpairwiseDE1000, NLpairwiseDE1000, file=file.path(DE_dir,paste0(esh,"_pairwise1000_DE.Rda")))
```

### DE of all WT regeneration samples by cluster
```{r differentialExpression3}
oneVallDE500 <- getBestFeatures(Xmat, clus.labels, contrastType="OneAgainstAll",contrastAdj="All", number=500, p.value=0.05)
write.table(oneVallDE500, file.path(DE_dir,"EWT_oneVallDE_limma_500.txt"),quote=FALSE,sep="\t")
oneVallDE1000 <- getBestFeatures(Xmat, clus.labels, contrastType="OneAgainstAll",contrastAdj="All", number=1000, p.value=0.05)
write.table(oneVallDE1000, file.path(DE_dir,"EWT_oneVallDE_limma_1000.txt"),quote=FALSE,sep="\t")
save(oneVallDE1000, oneVallDE500, file=file.path(DE_dir, paste0(esh, "_allCellsOneVAllDE.Rda")))

pairsDE500 <- getBestFeatures(Xmat, clus.labels, contrastType="Pairs",contrastAdj="All", number=500, p.value=0.05)
write.table(pairsDE500, file.path(DE_dir,"EWT_pairwiseDE_limma_500.txt"),quote=FALSE,sep="\t")
pairsDE1000 <- getBestFeatures(Xmat, clus.labels, contrastType="Pairs",contrastAdj="All", number=1000, p.value=0.05)
write.table(pairsDE1000, file.path(DE_dir,"EWT_pairwiseDE_limma_1000.txt"),quote=FALSE,sep="\t")

```

